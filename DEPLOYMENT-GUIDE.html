<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ç®¡ç†å‘˜ç»Ÿè®¡åŠŸèƒ½éƒ¨ç½²æŒ‡å— - M-Profile Lab</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      color: white;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: rgba(255,255,255,0.1);
      border-radius: 15px;
      padding: 30px;
      backdrop-filter: blur(10px);
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
      font-size: 2.5em;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    .section {
      background: rgba(255,255,255,0.2);
      border-radius: 12px;
      padding: 25px;
      margin: 20px 0;
    }
    .section h2 {
      color: #ffd700;
      margin-top: 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      margin: 10px 5px;
      transition: all 0.3s ease;
      font-size: 16px;
    }
    .btn-primary {
      background: #1976d2;
      color: white;
    }
    .btn-primary:hover {
      background: #1565c0;
      transform: translateY(-2px);
    }
    .btn-success {
      background: #4caf50;
      color: white;
    }
    .btn-success:hover {
      background: #45a049;
      transform: translateY(-2px);
    }
    .btn-warning {
      background: #ff9800;
      color: white;
    }
    .btn-warning:hover {
      background: #f57c00;
      transform: translateY(-2px);
    }
    .code-block {
      background: rgba(0,0,0,0.3);
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      overflow-x: auto;
      border-left: 4px solid #4caf50;
    }
    .warning-box {
      background: rgba(255, 152, 0, 0.2);
      border: 2px solid #ff9800;
      border-radius: 10px;
      padding: 20px;
      margin: 15px 0;
    }
    .success-box {
      background: rgba(76, 175, 80, 0.2);
      border: 2px solid #4caf50;
      border-radius: 10px;
      padding: 20px;
      margin: 15px 0;
    }
    .step {
      display: flex;
      align-items: flex-start;
      margin: 20px 0;
    }
    .step-number {
      background: #1976d2;
      color: white;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin-right: 15px;
      flex-shrink: 0;
    }
    .step-content {
      flex: 1;
    }
    .feature-list {
      list-style: none;
      padding: 0;
    }
    .feature-list li {
      padding: 8px 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .feature-list li:before {
      content: "âœ…";
      color: #4caf50;
      font-weight: bold;
    }
    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }
    .status-success { background: #4caf50; }
    .status-warning { background: #ff9800; }
    .status-error { background: #f44336; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸš€ ç®¡ç†å‘˜ç»Ÿè®¡åŠŸèƒ½éƒ¨ç½²æŒ‡å—</h1>
    
    <div class="section">
      <h2>ğŸ‰ éƒ¨ç½²çŠ¶æ€</h2>
      <div class="success-box">
        <h3>âœ… ç®¡ç†å‘˜åå°å·²æ›´æ–°å®Œæˆï¼</h3>
        <p>å½“å‰ç®¡ç†å‘˜åå°å·²ä½¿ç”¨ <strong>admin-new.html</strong> éªŒè¯è¿‡çš„ç»Ÿè®¡æŸ¥è¯¢æ–¹æ³•ã€‚</p>
        <p>ç»Ÿè®¡åŠŸèƒ½åº”è¯¥èƒ½å¤Ÿæ­£å¸¸æ˜¾ç¤ºæ•°æ®ï¼Œä¸å†å‡ºç°å…¨éƒ¨ä¸º0çš„é—®é¢˜ã€‚</p>
      </div>
    </div>

    <div class="section">
      <h2>ğŸ“‹ å¿«é€ŸéªŒè¯</h2>
      <p>è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤éªŒè¯æ–°åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š</p>
      
      <div class="step">
        <div class="step-number">1</div>
        <div class="step-content">
          <h4>è®¿é—®éªŒè¯å·¥å…·</h4>
          <p>æ‰“å¼€ä»¥ä¸‹é“¾æ¥æµ‹è¯•æ–°çš„ç»Ÿè®¡åŠŸèƒ½ï¼š</p>
          <div style="margin: 15px 0;">
            <a href="/verify-current-admin.html" target="_blank" style="text-decoration: none;">
              <button class="btn btn-primary">ğŸ” éªŒè¯å½“å‰ç®¡ç†å‘˜ç»Ÿè®¡</button>
            </a>
            <a href="/test-new-admin.html" target="_blank" style="text-decoration: none;">
              <button class="btn btn-success">ğŸ§ª æµ‹è¯•æ–°ç»Ÿè®¡åŠŸèƒ½</button>
            </a>
          </div>
        </div>
      </div>

      <div class="step">
        <div class="step-number">2</div>
        <div class="step-content">
          <h4>è®¿é—®ç®¡ç†å‘˜åå°</h4>
          <p>ç›´æ¥è®¿é—®ç®¡ç†å‘˜åå°æŸ¥çœ‹å®é™…æ•ˆæœï¼š</p>
          <div style="margin: 15px 0;">
            <a href="/admin.html" target="_blank" style="text-decoration: none;">
              <button class="btn btn-warning">ğŸš€ æ‰“å¼€ç®¡ç†å‘˜åå°</button>
            </a>
          </div>
          <p><strong>ç™»å½•ä¿¡æ¯ï¼š</strong> ç”¨æˆ·å: admin, å¯†ç : admin123</p>
        </div>
      </div>

      <div class="step">
        <div class="step-number">3</div>
        <div class="step-content">
          <h4>éªŒè¯æ•°æ®æ­£ç¡®æ€§</h4>
          <p>åœ¨ç®¡ç†å‘˜åå°ä¸­æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
          <ul class="feature-list">
            <li>ä»ªè¡¨æ¿ç»Ÿè®¡æ•°æ®ä¸ä¸º0</li>
            <li>æ€»æµ‹è¯•æ•°ä¸æµ‹è¯„è®°å½•ç®¡ç†ä¸­çš„æ•°é‡ä¸€è‡´</li>
            <li>ä»Šæ—¥ç”¨æˆ·å’Œä»Šæ—¥æµ‹è¯•æ•°æ®åˆç†</li>
            <li>æµ‹è¯•ç±»å‹åˆ†å¸ƒå›¾è¡¨æ­£å¸¸æ˜¾ç¤º</li>
            <li>åœ°ç†ä½ç½®ç»Ÿè®¡æ­£å¸¸åŠ è½½</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="section">
      <h2>ğŸ”§ æŠ€æœ¯å®ç°</h2>
      <p>æ–°çš„ç»Ÿè®¡åŠŸèƒ½åŸºäºä»¥ä¸‹æŠ€æœ¯æ”¹è¿›ï¼š</p>
      
      <div class="success-box">
        <h4>âœ… å…³é”®æ”¹è¿›</h4>
        <ul class="feature-list">
          <li>ç§»é™¤ problematic çš„ <code>head: true</code> å‚æ•°</li>
          <li>ä½¿ç”¨ <code>.select('id', { count: 'exact' })</code> æ›¿ä»£å¤æ‚æŸ¥è¯¢</li>
          <li>é‡‡ç”¨ <code>Promise.allSettled()</code> å¤„ç†å¤šä¸ªæŸ¥è¯¢</li>
          <li>æ·»åŠ å¤šé‡å¤‡ç”¨æ–¹æ¡ˆå’Œé”™è¯¯å¤„ç†</li>
          <li>å¢å¼ºè°ƒè¯•æ—¥å¿—ä¾¿äºé—®é¢˜æ’æŸ¥</li>
        </ul>
      </div>

      <h4>æ ¸å¿ƒæŸ¥è¯¢é€»è¾‘</h4>
      <div class="code-block">
// æ–°çš„ç»Ÿè®¡æŸ¥è¯¢æ–¹æ³•ï¼ˆåŸºäºadmin-new.htmléªŒè¯ï¼‰
const queries = [
  supabase.from('users').select('id', { count: 'exact' }),
  supabase.from('test_records').select('id', { count: 'exact' }),
  supabase.from('messages').select('id', { count: 'exact' })
];

const results = await Promise.allSettled(queries);
const totalTests = results[1].status === 'fulfilled' ? results[1].value.count : 0;
      </div>
    </div>

    <div class="section">
      <h2>ğŸ“Š æµ‹è¯•æ•°æ®å¯¹æ¯”</h2>
      <p>å¦‚æœæ‚¨æƒ³è¿›ä¸€æ­¥éªŒè¯ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·è¿›è¡Œè¯¦ç»†å¯¹æ¯”ï¼š</p>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0;">
        <div class="status-card" style="text-align: center;">
          <h4>ğŸ” è°ƒè¯•å·¥å…·</h4>
          <a href="/debug-stats.html" target="_blank" style="text-decoration: none;">
            <button class="btn btn-primary">æŸ¥è¯¢æ–¹æ³•å¯¹æ¯”</button>
          </a>
          <p style="font-size: 0.9em; margin-top: 10px;">å¯¹æ¯”4ç§ä¸åŒæŸ¥è¯¢æ–¹æ³•çš„æ•ˆæœ</p>
        </div>
        
        <div class="status-card" style="text-align: center;">
          <h4>ğŸ§ª åŠŸèƒ½æµ‹è¯•</h4>
          <a href="/test-stats-fix.html" target="_blank" style="text-decoration: none;">
            <button class="btn btn-success">åŸå§‹ä¿®å¤æµ‹è¯•</button>
          </a>
          <p style="font-size: 0.9em; margin-top: 10px;">æµ‹è¯•æœ€åˆçš„ç»Ÿè®¡ä¿®å¤æ–¹æ¡ˆ</p>
        </div>
        
        <div class="status-card" style="text-align: center;">
          <h4>ğŸ“ˆ æ–°åŠŸèƒ½æµ‹è¯•</h4>
          <a href="/test-new-admin.html" target="_blank" style="text-decoration: none;">
            <button class="btn btn-warning">æ–°åŠŸèƒ½è¯¦ç»†æµ‹è¯•</button>
          </a>
          <p style="font-size: 0.9em; margin-top: 10px;">å…¨é¢çš„æ–°ç»Ÿè®¡åŠŸèƒ½æµ‹è¯•</p>
        </div>
      </div>
    </div>

    <div class="section">
      <h2>âš ï¸ æ³¨æ„äº‹é¡¹</h2>
      <div class="warning-box">
        <h4>ğŸ” éªŒè¯è¦ç‚¹</h4>
        <ul>
          <li><span class="status-indicator status-success"></span>ç¡®ä¿ç¯å¢ƒå˜é‡å·²æ­£ç¡®é…ç½®</li>
          <li><span class="status-indicator status-success"></span>æ•°æ®åº“è¿æ¥æ­£å¸¸ï¼Œè¡¨ç»“æ„å®Œæ•´</li>
          <li><span class="status-indicator status-success"></span>ç®¡ç†å‘˜è´¦æˆ·å¯æ­£å¸¸ç™»å½•</li>
          <li><span class="status-indicator status-warning"></span>å¦‚æœç»Ÿè®¡æ•°æ®ä»ä¸º0ï¼Œè¯·æ£€æŸ¥æ˜¯å¦æœ‰æµ‹è¯•è®°å½•</li>
          <li><span class="status-indicator status-info"></span>æ–°åŠŸèƒ½å·²è‡ªåŠ¨éƒ¨ç½²ï¼Œæ— éœ€é¢å¤–é…ç½®</li>
        </ul>
      </div>
    </div>

    <div class="section">
      <h2>ğŸ†˜ é—®é¢˜æ’æŸ¥</h2>
      <p>å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ’æŸ¥ï¼š</p>
      
      <div class="step">
        <div class="step-number">1</div>
        <div class="step-content">
          <h4>æ£€æŸ¥ç¯å¢ƒå˜é‡</h4>
          <div class="code-block">
# åœ¨æµè§ˆå™¨æ§åˆ¶å°æ£€æŸ¥
console.log('VITE_SUPABASE_URL:', import.meta.env.VITE_SUPABASE_URL);
console.log('VITE_SUPABASE_ANON_KEY:', import.meta.env.VITE_SUPABASE_ANON_KEY);
          </div>
        </div>
      </div>

      <div class="step">
        <div class="step-number">2</div>
        <div class="step-content">
          <h4>æ£€æŸ¥æ•°æ®åº“è¿æ¥</h4>
          <p>ä½¿ç”¨éªŒè¯å·¥å…·æµ‹è¯•æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸ã€‚</p>
        </div>
      </div>

      <div class="step">
        <div class="step-number">3</div>
        <div class="step-content">
          <h4>æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°</h4>
          <p>æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ŒæŸ¥çœ‹æ§åˆ¶å°ä¸­çš„è¯¦ç»†æ—¥å¿—ä¿¡æ¯ã€‚</p>
        </div>
      </div>

      <div class="step">
        <div class="step-number">4</div>
        <div class="step-content">
          <h4>è”ç³»æ”¯æŒ</h4>
          <p>å¦‚æœé—®é¢˜ä»æœªè§£å†³ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
          <ul>
            <li>æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯æ—¥å¿—</li>
            <li>ç¯å¢ƒå˜é‡é…ç½®çŠ¶æ€</li>
            <li>æ•°æ®åº“è¿æ¥æµ‹è¯•ç»“æœ</li>
            <li>å…·ä½“çš„é”™è¯¯ç°è±¡æè¿°</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="section">
      <h2>ğŸ“‹ æ–‡ä»¶å˜æ›´æ€»ç»“</h2>
      <p>ä»¥ä¸‹æ–‡ä»¶å·²è¢«æ›´æ–°ä»¥æ”¯æŒæ–°çš„ç»Ÿè®¡åŠŸèƒ½ï¼š</p>
      
      <div class="code-block">
# ä¸»è¦æ›´æ–°æ–‡ä»¶
src/AdminApp.jsx                          # å®Œå…¨é‡å†™ç»Ÿè®¡æŸ¥è¯¢é€»è¾‘
admin-new.html                            # æ–°ç®¡ç†å‘˜ç•Œé¢æµ‹è¯•å·¥å…·
test-new-admin.html                       # æ–°åŠŸèƒ½è¯¦ç»†æµ‹è¯•å·¥å…·
verify-current-admin.html                 # å½“å‰å®ç°éªŒè¯å·¥å…·
DEPLOYMENT-GUIDE.html                     # éƒ¨ç½²æŒ‡å—ï¼ˆæœ¬æ–‡ä»¶ï¼‰

# å¤‡ä»½æ–‡ä»¶
src/AdminApp-old-backup.jsx               # åŸå§‹AdminAppå¤‡ä»½
      </div>
    </div>

    <div class="section" style="text-align: center;">
      <h2>ğŸ‰ éƒ¨ç½²å®Œæˆï¼</h2>
      <p>ç®¡ç†å‘˜ç»Ÿè®¡åŠŸèƒ½å·²æˆåŠŸæ›´æ–°ï¼Œç°åœ¨å¯ä»¥æ­£å¸¸æ˜¾ç¤ºæ•°æ®äº†ã€‚</p>
      <div style="margin: 20px 0;">
        <a href="/admin.html" target="_blank" style="text-decoration: none;">
          <button class="btn btn-success" style="font-size: 18px; padding: 15px 30px;">
            ğŸš€ ç«‹å³ä½“éªŒæ–°ç®¡ç†å‘˜åå°
          </button>
        </a>
      </div>
      <p style="color: #ffd700; font-weight: bold;">ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼</p>
    </div>
  </div>

  <script>
    // è‡ªåŠ¨æ£€æŸ¥å½“å‰é¡µé¢çŠ¶æ€
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ğŸš€ ç®¡ç†å‘˜ç»Ÿè®¡åŠŸèƒ½éƒ¨ç½²æŒ‡å—å·²åŠ è½½');
      console.log('âœ… æ–°çš„ç»Ÿè®¡æ–¹æ³•å·²åŸºäº admin-new.html éªŒè¯æˆåŠŸ');
      console.log('âœ… AdminApp.jsx å·²æ›´æ–°ä¸ºæ–°çš„æŸ¥è¯¢é€»è¾‘');
      console.log('âœ… ç®¡ç†å‘˜åå°ç»Ÿè®¡åŠŸèƒ½åº”è¯¥å¯ä»¥æ­£å¸¸å·¥ä½œäº†ï¼');
    });

    // æä¾›å¿«é€Ÿè®¿é—®åŠŸèƒ½
    function quickTest() {
      window.open('/verify-current-admin.html', '_blank');
    }

    function goToAdmin() {
      window.open('/admin.html', '_blank');
    }
  </script>
</body>
</html>